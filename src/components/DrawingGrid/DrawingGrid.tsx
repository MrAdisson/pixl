import React, { CSSProperties, useEffect, useRef, useState } from 'react';
import { Color } from '../../types/Color';
import Pixel from '../Pixel/Pixel';
import Draggable from 'react-draggable';
import { useAppSelector } from '../../hooks/redux';

const DrawingGrid = ({
  height = 16,
  width = 16,
}: {
  height: number;
  width: number;
}) => {
  //MY FILE FORMAT ! :D
  //   const defaultFile =
  //     '#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000;#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000;#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000;#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000;#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000;#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000;#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000;#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000;#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000;#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000;#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000;#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000;#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000;#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000;#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000;#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000,#990000';
  //   console.log(defaultFile.split(';').map((x) => x.split(',')));

  //   const pixelArray = useRef<Color[][]>(
  //     defaultFile.split(';').map((x) => x.split(','))
  //   );

  const DEFAULT_ZOOM = 30;

  const defaultSizedArray = Array(height).fill(Array(width).fill('white'));

  const pixelArray = useRef<Color[][]>(defaultSizedArray);

  const [zoom, setZoom] = useState<number>(DEFAULT_ZOOM);

  const tools = useAppSelector((state) => state.tools);
  return (
    <Draggable disabled={!(tools.mode === 'GRAB')}>
      <div
        onWheel={(e) => {
          if (e.deltaY >= 0) {
            //Scroll down
            if (zoom === 1) return;
            setZoom(zoom - 1);
          } else {
            //Scroll up
            setZoom(zoom + 1);
          }
        }}
        style={styles.gridContainer as CSSProperties}
      >
        {pixelArray.current.map((row, rowIndex) => {
          return (
            <div className='row' style={{ display: 'flex', flexDirection: 'row' }}>
              {row.map((color, columnIndex) => (
                <Pixel
                  color={color}
                  coordinate={{ x: columnIndex, y: rowIndex }}
                  zoom={zoom}
                  key={`Pixel${rowIndex}_${columnIndex}`}
                />
              ))}
            </div>
          );
        })}
      </div>
    </Draggable>
  );
};

const styles = {
  gridContainer: {
    padding: 3,
    border: '3px solid black',
  },
};

export default DrawingGrid;
